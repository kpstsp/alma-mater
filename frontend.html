<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Survey App</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; }
        .survey-list { margin-bottom: 2em; }
        .survey-item { margin-bottom: 0.5em; }
        .form-section { margin-bottom: 2em; border: 1px solid #ccc; padding: 1em; border-radius: 8px; }
        .question { margin-bottom: 1em; }
        textarea { width: 100%; height: 100px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Student Survey App</h1>

    <div class="survey-list form-section">
        <h2>Available Surveys</h2>
        <div id="surveys"></div>
        <button onclick="fetchSurveys()">Refresh List</button>
    </div>

    <div class="form-section">
        <h2>Create New Survey (Paste JSON)</h2>
        <textarea id="new-survey-json" placeholder='{"title": "Sample Survey", "description": "Desc", "questions": [{"text": "Q1?", "type": "text"}], "correct_answers": {"Q1?": "answer"}}'></textarea><br>
        <button onclick="createSurvey()">Create Survey</button>
        <div id="create-message"></div>
    </div>

    <script>
    const API_URL = "http://localhost:8095";

    async function fetchSurveys() {
        const res = await fetch(`${API_URL}/surveys/`);
        const surveys = await res.json();
        const container = document.getElementById('surveys');
        container.innerHTML = '';
        if (surveys.length === 0) {
            container.innerHTML = '<em>No surveys available.</em>';
            return;
        }
        surveys.forEach(survey => {
            const div = document.createElement('div');
            div.className = 'survey-item';
            div.innerHTML = `<b>${survey.title}</b> - ${survey.description || ''} <a href="fill.html?survey_id=${survey.id}"><button>Fill Out</button></a>`;
            container.appendChild(div);
        });
    }

    async function createSurvey() {
        const jsonText = document.getElementById('new-survey-json').value;
        let surveyObj;
        try {
            surveyObj = JSON.parse(jsonText);
        } catch (e) {
            document.getElementById('create-message').innerHTML = '<span class="error">Invalid JSON.</span>';
            return;
        }
        const resp = await fetch(`${API_URL}/surveys/`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(surveyObj)
        });
        if (resp.ok) {
            document.getElementById('create-message').innerHTML = '<span class="success">Survey created!</span>';
            document.getElementById('new-survey-json').value = '';
            fetchSurveys();
        } else {
            document.getElementById('create-message').innerHTML = '<span class="error">Failed to create survey.</span>';
        }
    }

    // Initial load
    fetchSurveys();
    </script>
</body>
</html> 